<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>회원가입</title>
  <link rel="stylesheet" href="style0724.css" />
</head>
<body>
  <div class="gym-title">RMSANXO Fitness Club</div>
  <form id="signupForm" action="/signup" method="POST">
    <h1>회원가입</h1>

    <label for="username">아이디</label>
    <input type="text" id="username" name="username" required />
    <div id="usernameMsg" style="color:red; font-size:0.9em;"></div>

    <label for="password">비밀번호</label>
    <input type="password" id="password" name="password" required />
    <div style="font-size: 0.9em; color:gray;">
      * 비밀번호는 영문, 숫자, 특수문자를 포함한 8자 이상이어야 합니다.
    </div>

    <label for="email">이메일</label>
    <input type="email" id="email" name="email" required />

    <button type="submit">가입하기</button>
  </form>

  <script>
    const form = document.getElementById("signupForm");
    const usernameMsg = document.getElementById("usernameMsg");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      // 아이디 정규식
      const idRegex = /^[a-zA-Z0-9]{4,12}$/;
      if (!idRegex.test(username)) {
        usernameMsg.textContent = "아이디는 영어/숫자 조합 4~12자여야 합니다.";
        return;
      }

      // 비밀번호 정규식
      const pwRegex = /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*]).{8,}$/;
      if (!pwRegex.test(password)) {
        alert("비밀번호는 영문, 숫자, 특수문자를 포함한 8자 이상이어야 합니다.");
        return;
      }

      // 서버에 아이디 중복 확인 요청
      const res = await fetch(`/check-username?username=${encodeURIComponent(username)}`);
      const data = await res.json();

      if (data.exists) {
        usernameMsg.textContent = "이미 존재하는 아이디입니다.";
        return;
      }

      // 중복 없음 → 폼 제출
      form.submit();
    });
  </script>
</body>
</html>
